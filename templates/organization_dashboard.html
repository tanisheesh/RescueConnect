{% extends "base.html" %}

{% block title %}Organization Dashboard - Emergency Response Platform{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Organization Dashboard</h1>
        <div class="user-info">
            <span id="userGreeting">Welcome back!</span>
            <span class="user-type">Organization</span>
        </div>
    </div>
    
    <div class="dashboard-stats">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number" id="activeRequests">0</div>
                <div class="stat-label">Active Requests</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number" id="totalApplications">0</div>
                <div class="stat-label">Total Applications</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number" id="pendingApplications">0</div>
                <div class="stat-label">Pending Applications</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number" id="avgResponseTime">0h</div>
                <div class="stat-label">Avg Response Time</div>
            </div>
        </div>
    </div>
    
    <div class="dashboard-content">
        <div class="dashboard-section">
            <div class="section-header">
                <h2>Quick Actions</h2>
            </div>
            <div class="quick-actions">
                <a href="#" class="action-card" onclick="openCreateRequestModal()">
                    <i class="fas fa-plus-circle"></i>
                    <span>Create Emergency Request</span>
                </a>
                <a href="/emergency" class="action-card">
                    <i class="fas fa-list"></i>
                    <span>Manage Requests</span>
                </a>
                <a href="/skills" class="action-card">
                    <i class="fas fa-search"></i>
                    <span>Find Volunteers</span>
                </a>
            </div>
        </div>
        
        <div class="dashboard-section">
            <div class="section-header">
                <h2>Recent Emergency Requests</h2>
                <button class="btn btn-primary btn-small" id="refreshRequests">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            <div class="requests-list" id="requestsList">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Loading requests...</span>
                </div>
            </div>
        </div>
        
        <div class="dashboard-section">
            <div class="section-header">
                <h2>Volunteer Applications</h2>
                <div class="section-controls">
                    <select id="applicationStatusFilter">
                        <option value="">All Applications</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                    <button class="btn btn-secondary btn-small" id="refreshApplications">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            <div class="applications-list" id="applicationsList">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Loading applications...</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Create Request Modal -->
<div id="quickCreateModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Quick Emergency Request</h2>
            <button class="modal-close" onclick="closeQuickCreateModal()">&times;</button>
        </div>
        <form id="quickCreateForm" class="modal-form">
            <div class="form-group">
                <label for="quickTitle">Title *</label>
                <input type="text" id="quickTitle" name="title" required>
            </div>
            
            <div class="form-group">
                <label for="quickDescription">Description *</label>
                <textarea id="quickDescription" name="description" rows="3" required></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="quickCategory">Category *</label>
                    <select id="quickCategory" name="category_id" required>
                        <option value="">Select category</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="quickPriority">Priority *</label>
                    <select id="quickPriority" name="priority_level" required>
                        <option value="">Select priority</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                        <option value="critical">Critical</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="quickState">State *</label>
                    <select id="quickState" name="state" required>
                        <option value="">Select State</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="quickDistrict">District *</label>
                    <input type="text" id="quickDistrict" name="district" required placeholder="Enter district">
                </div>
            </div>
            
            <div class="form-group">
                <label for="quickVolunteers">Volunteers Needed</label>
                <input type="number" id="quickVolunteers" name="volunteers_needed" min="1" value="1">
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeQuickCreateModal()">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="goToFullForm()">Full Form</button>
                <button type="submit" class="btn btn-success">Create Request</button>
            </div>
        </form>
    </div>
</div>

<!-- Application Details Modal -->
<div id="applicationModal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2 id="applicationTitle">Application Details</h2>
            <button class="modal-close" onclick="closeApplicationModal()">&times;</button>
        </div>
        <div id="applicationContent">
            <!-- Content will be loaded dynamically -->
        </div>
    </div>
</div>

<!-- Request Volunteers Modal -->
<div id="volunteersModal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2 id="volunteersTitle">Request Volunteers</h2>
            <button class="modal-close" onclick="closeVolunteersModal()">&times;</button>
        </div>
        <div id="volunteersContent">
            <!-- Content will be loaded dynamically -->
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let currentUser = null;
let allApplications = [];
let allCategories = [];

document.addEventListener('DOMContentLoaded', function() {
    if (!checkAuth()) return;
    
    currentUser = auth.getUser();
    
    if (currentUser.user_type !== 'organization') {
        window.location.href = '/dashboard';
        return;
    }
    
    initializeOrganizationDashboard();
    loadOrganizationData();
});

function initializeOrganizationDashboard() {
    document.getElementById('userGreeting').textContent = `Welcome back, ${currentUser.full_name}!`;
    
    // Set up event listeners
    document.getElementById('refreshRequests').addEventListener('click', loadEmergencyRequests);
    document.getElementById('refreshApplications').addEventListener('click', loadApplications);
    document.getElementById('applicationStatusFilter').addEventListener('change', loadApplications);
    document.getElementById('quickCreateForm').addEventListener('submit', quickCreateRequest);
    
    // Load categories and states
    loadCategories();
    loadStates();
}

async function loadOrganizationData() {
    await Promise.all([
        loadEmergencyRequests(),
        loadApplications(),
        loadOrganizationStats()
    ]);
}

async function loadCategories() {
    try {
        const response = await apiCall('/api/categories?type=disaster');
        const data = await response.json();
        
        if (response.ok) {
            allCategories = data.categories;
            populateCategoryDropdown();
        }
    } catch (error) {
        console.error('Error loading categories:', error);
    }
}

function populateCategoryDropdown() {
    const categorySelect = document.getElementById('quickCategory');
    allCategories.forEach(category => {
        const option = document.createElement('option');
        option.value = category.id;
        option.textContent = category.name;
        categorySelect.appendChild(option);
    });
}

function loadStates() {
    const states = [
        'Andhra Pradesh', 'Arunachal Pradesh', 'Assam', 'Bihar', 'Chhattisgarh', 'Goa', 'Gujarat', 'Haryana',
        'Himachal Pradesh', 'Jharkhand', 'Karnataka', 'Kerala', 'Madhya Pradesh', 'Maharashtra', 'Manipur',
        'Meghalaya', 'Mizoram', 'Nagaland', 'Odisha', 'Punjab', 'Rajasthan', 'Sikkim', 'Tamil Nadu',
        'Telangana', 'Tripura', 'Uttar Pradesh', 'Uttarakhand', 'West Bengal', 'Andaman and Nicobar Islands',
        'Chandigarh', 'Dadra and Nagar Haveli and Daman and Diu', 'Delhi', 'Jammu and Kashmir', 'Ladakh',
        'Lakshadweep', 'Puducherry'
    ];
    
    const stateSelect = document.getElementById('quickState');
    states.forEach(state => {
        const option = document.createElement('option');
        option.value = state;
        option.textContent = state;
        stateSelect.appendChild(option);
    });
}

async function loadEmergencyRequests() {
    try {
        const response = await apiCall('/api/emergency/requests');
        const data = await response.json();
        
        if (response.ok) {
            displayRequests(data.requests);
        }
    } catch (error) {
        console.error('Error loading requests:', error);
        document.getElementById('requestsList').innerHTML = '<div class="no-data">Failed to load requests</div>';
    }
}

async function loadApplications() {
    const statusFilter = document.getElementById('applicationStatusFilter').value;
    
    try {
        const response = await apiCall(`/api/organization/applications${statusFilter ? '?status=' + statusFilter : ''}`);
        const data = await response.json();
        
        if (response.ok) {
            allApplications = data.applications;
            displayApplications(data.applications);
        }
    } catch (error) {
        console.error('Error loading applications:', error);
        document.getElementById('applicationsList').innerHTML = '<div class="no-data">Failed to load applications</div>';
    }
}

async function loadOrganizationStats() {
    try {
        const response = await apiCall('/api/organization/stats');
        const data = await response.json();
        
        if (response.ok) {
            updateDashboardStats(data.stats);
        }
    } catch (error) {
        console.error('Error loading stats:', error);
    }
}

function displayRequests(requests) {
    const container = document.getElementById('requestsList');
    
    if (requests.length === 0) {
        container.innerHTML = '<div class="no-data">No emergency requests created yet</div>';
        return;
    }
    
    // Show only recent requests (last 5)
    const recentRequests = requests.slice(0, 5);
    
    container.innerHTML = recentRequests.map(request => `
        <div class="request-item priority-${request.priority_level} status-${request.status}">
            <div class="request-header">
                <h4>${request.title}</h4>
                <div class="request-badges">
                    <span class="priority-badge priority-${request.priority_level}">${request.priority_level.toUpperCase()}</span>
                    <span class="status-badge status-${request.status}">${request.status.replace('_', ' ').toUpperCase()}</span>
                    ${!request.is_approved ? '<span class="approval-badge pending">PENDING APPROVAL</span>' : ''}
                </div>
            </div>
            <div class="request-details">
                <p>${request.description.substring(0, 100)}${request.description.length > 100 ? '...' : ''}</p>
                <div class="request-meta">
                    <span><i class="fas fa-map-marker-alt"></i> ${request.state}, ${request.district}</span>
                    <span><i class="fas fa-users"></i> ${request.volunteers_assigned || 0}/${request.volunteers_needed} volunteers</span>
                    <span><i class="fas fa-clock"></i> ${formatRelativeTime(request.created_at)}</span>
                    ${request.category_name ? `<span><i class="fas fa-tag"></i> ${request.category_name}</span>` : ''}
                </div>
            </div>
            <div class="request-actions">
                <button class="btn btn-primary btn-small" onclick="viewRequestDetails(${request.id})">
                    <i class="fas fa-eye"></i> View Details
                </button>
                ${request.is_approved && (request.status === 'approved' || request.status === 'active') ? `
                    <button class="btn btn-secondary btn-small" onclick="viewRequestVolunteers(${request.id})">
                        <i class="fas fa-users"></i> View Volunteers
                    </button>
                    <button class="btn btn-info btn-small" onclick="manageApplications(${request.id})">
                        <i class="fas fa-clipboard-list"></i> Applications
                    </button>
                ` : ''}
            </div>
        </div>
    `).join('');
}

function displayApplications(applications) {
    const container = document.getElementById('applicationsList');
    
    if (applications.length === 0) {
        container.innerHTML = '<div class="no-data">No volunteer applications yet</div>';
        return;
    }
    
    container.innerHTML = applications.map(application => `
        <div class="application-item status-${application.status}">
            <div class="application-header">
                <div class="volunteer-info">
                    <h4>${application.volunteer_name}</h4>
                    <p class="request-title">${application.request_title}</p>
                </div>
                <div class="application-badges">
                    <span class="status-badge status-${application.status}">${application.status.toUpperCase()}</span>
                    <span class="priority-badge priority-${application.priority_level}">${application.priority_level.toUpperCase()}</span>
                </div>
            </div>
            <div class="application-details">
                <div class="application-meta">
                    <span><i class="fas fa-envelope"></i> ${application.volunteer_email}</span>
                    <span><i class="fas fa-phone"></i> ${application.volunteer_phone || 'Not provided'}</span>
                    <span><i class="fas fa-map-marker-alt"></i> ${application.volunteer_state}, ${application.volunteer_district}</span>
                    <span><i class="fas fa-clock"></i> Applied ${formatRelativeTime(application.applied_at)}</span>
                </div>
                ${application.message ? `<p class="application-message">"${application.message}"</p>` : ''}
            </div>
            <div class="application-actions">
                <button class="btn btn-primary btn-small" onclick="viewApplicationDetails(${application.id})">
                    <i class="fas fa-eye"></i> View Details
                </button>
                ${application.status === 'pending' ? `
                    <button class="btn btn-success btn-small" onclick="respondToApplication(${application.id}, 'approved')">
                        <i class="fas fa-check"></i> Approve
                    </button>
                    <button class="btn btn-danger btn-small" onclick="respondToApplication(${application.id}, 'rejected')">
                        <i class="fas fa-times"></i> Reject
                    </button>
                ` : ''}
            </div>
        </div>
    `).join('');
}

function updateDashboardStats(stats) {
    document.getElementById('activeRequests').textContent = stats.approvedRequests || 0;
    document.getElementById('totalApplications').textContent = stats.totalApplications || 0;
    document.getElementById('pendingApplications').textContent = stats.pendingApplications || 0;
    document.getElementById('avgResponseTime').textContent = stats.avgResponseTime || '0h';
}

function openCreateRequestModal() {
    const modal = document.getElementById('quickCreateModal');
    modal.style.display = 'flex';
    setTimeout(() => modal.classList.add('show'), 10);
}

function closeQuickCreateModal() {
    const modal = document.getElementById('quickCreateModal');
    modal.classList.remove('show');
    setTimeout(() => {
        modal.style.display = 'none';
        document.getElementById('quickCreateForm').reset();
    }, 300);
}

function goToFullForm() {
    closeQuickCreateModal();
    window.location.href = '/emergency';
}

async function quickCreateRequest(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);
    
    data.volunteers_needed = parseInt(data.volunteers_needed) || 1;
    
    try {
        const response = await apiCall('/api/emergency/requests', {
            method: 'POST',
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (response.ok) {
            showNotification('Emergency request created successfully and is pending admin approval!', 'success');
            closeQuickCreateModal();
            loadEmergencyRequests();
            loadOrganizationStats();
        } else {
            showNotification(result.error || 'Failed to create request', 'error');
        }
    } catch (error) {
        handleApiError(error, 'Failed to create request');
    }
}

function viewRequestDetails(requestId) {
    window.location.href = `/emergency#request-${requestId}`;
}

function manageApplications(requestId) {
    // Filter applications for this request
    const requestApplications = allApplications.filter(app => app.request_id === requestId);
    displayApplications(requestApplications);
    
    // Scroll to applications section
    document.getElementById('applicationsList').scrollIntoView({ behavior: 'smooth' });
}

async function viewApplicationDetails(applicationId) {
    try {
        const application = allApplications.find(app => app.id === applicationId);
        if (!application) {
            showNotification('Application not found', 'error');
            return;
        }
        
        displayApplicationDetails(application);
        const modal = document.getElementById('applicationModal');
        modal.style.display = 'flex';
        setTimeout(() => modal.classList.add('show'), 10);
    } catch (error) {
        handleApiError(error, 'Failed to load application details');
    }
}

function displayApplicationDetails(application) {
    document.getElementById('applicationTitle').textContent = `Application from ${application.volunteer_name}`;
    
    const content = document.getElementById('applicationContent');
    content.innerHTML = `
        <div class="application-details-content">
            <div class="detail-section">
                <h3>Volunteer Information</h3>
                <div class="detail-grid">
                    <div class="detail-item">
                        <label>Name:</label>
                        <span>${application.volunteer_name}</span>
                    </div>
                    <div class="detail-item">
                        <label>Email:</label>
                        <span>${application.volunteer_email}</span>
                    </div>
                    <div class="detail-item">
                        <label>Phone:</label>
                        <span>${application.volunteer_phone || 'Not provided'}</span>
                    </div>
                    <div class="detail-item">
                        <label>Location:</label>
                        <span>${application.volunteer_state}, ${application.volunteer_district}</span>
                    </div>
                </div>
            </div>
            
            <div class="detail-section">
                <h3>Request Information</h3>
                <div class="detail-grid">
                    <div class="detail-item">
                        <label>Request:</label>
                        <span>${application.request_title}</span>
                    </div>
                    <div class="detail-item">
                        <label>Priority:</label>
                        <span class="priority-badge priority-${application.priority_level}">${application.priority_level.toUpperCase()}</span>
                    </div>
                    <div class="detail-item">
                        <label>Applied:</label>
                        <span>${formatDateTime(application.applied_at)}</span>
                    </div>
                    <div class="detail-item">
                        <label>Status:</label>
                        <span class="status-badge status-${application.status}">${application.status.toUpperCase()}</span>
                    </div>
                </div>
            </div>
            
            ${application.message ? `
                <div class="detail-section">
                    <h3>Application Message</h3>
                    <p class="application-message">${application.message}</p>
                </div>
            ` : ''}
            
            ${application.status === 'pending' ? `
                <div class="detail-section">
                    <h3>Actions</h3>
                    <div class="application-actions">
                        <button class="btn btn-success" onclick="respondToApplication(${application.id}, 'approved')">
                            <i class="fas fa-check"></i> Approve Application
                        </button>
                        <button class="btn btn-danger" onclick="respondToApplication(${application.id}, 'rejected')">
                            <i class="fas fa-times"></i> Reject Application
                        </button>
                    </div>
                </div>
            ` : ''}
            
            ${application.responded_at ? `
                <div class="detail-section">
                    <h3>Response Information</h3>
                    <p><strong>Responded:</strong> ${formatDateTime(application.responded_at)}</p>
                    ${application.response_message ? `<p><strong>Message:</strong> ${application.response_message}</p>` : ''}
                </div>
            ` : ''}
        </div>
    `;
}

function closeApplicationModal() {
    const modal = document.getElementById('applicationModal');
    modal.classList.remove('show');
    setTimeout(() => {
        modal.style.display = 'none';
    }, 300);
}

function closeVolunteersModal() {
    const modal = document.getElementById('volunteersModal');
    modal.classList.remove('show');
    setTimeout(() => {
        modal.style.display = 'none';
    }, 300);
}

async function viewRequestVolunteers(requestId) {
    try {
        const response = await apiCall(`/api/organization/request-volunteers/${requestId}`);
        const data = await response.json();
        
        if (response.ok) {
            displayRequestVolunteers(data.request, data.volunteers);
            const modal = document.getElementById('volunteersModal');
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('show'), 10);
        } else {
            showNotification(data.error || 'Failed to load volunteers', 'error');
        }
    } catch (error) {
        handleApiError(error, 'Failed to load volunteers');
    }
}

function displayRequestVolunteers(request, volunteers) {
    document.getElementById('volunteersTitle').textContent = `Volunteers for: ${request.title}`;
    
    const content = document.getElementById('volunteersContent');
    content.innerHTML = `
        <div class="volunteers-content">
            <div class="request-summary">
                <h3>Request Summary</h3>
                <div class="summary-grid">
                    <div class="summary-item">
                        <label>Title:</label>
                        <span>${request.title}</span>
                    </div>
                    <div class="summary-item">
                        <label>Priority:</label>
                        <span class="priority-badge priority-${request.priority_level}">${request.priority_level.toUpperCase()}</span>
                    </div>
                    <div class="summary-item">
                        <label>Location:</label>
                        <span>${request.state}, ${request.district}</span>
                    </div>
                    <div class="summary-item">
                        <label>Volunteers:</label>
                        <span>${volunteers.length}/${request.volunteers_needed} assigned</span>
                    </div>
                </div>
            </div>
            
            <div class="volunteers-section">
                <h3>Volunteers (${volunteers.length})</h3>
                ${volunteers.length === 0 ? `
                    <div class="no-data">No volunteers assigned to this request yet</div>
                ` : `
                    <div class="volunteers-grid">
                        ${volunteers.map(volunteer => `
                            <div class="volunteer-card status-${volunteer.status}">
                                <div class="volunteer-header">
                                    <h4>${volunteer.volunteer_name}</h4>
                                    <span class="status-badge status-${volunteer.status}">${volunteer.status.toUpperCase()}</span>
                                </div>
                                <div class="volunteer-details">
                                    <div class="volunteer-info">
                                        <span><i class="fas fa-envelope"></i> ${volunteer.volunteer_email}</span>
                                        <span><i class="fas fa-phone"></i> ${volunteer.volunteer_phone || 'Not provided'}</span>
                                        <span><i class="fas fa-map-marker-alt"></i> ${volunteer.volunteer_state}, ${volunteer.volunteer_district}</span>
                                    </div>
                                    <div class="volunteer-meta">
                                        <span><i class="fas fa-clock"></i> Applied: ${formatRelativeTime(volunteer.applied_at)}</span>
                                        ${volunteer.responded_at ? `<span><i class="fas fa-check"></i> Responded: ${formatRelativeTime(volunteer.responded_at)}</span>` : ''}
                                    </div>
                                    ${volunteer.message ? `<p class="volunteer-message">"${volunteer.message}"</p>` : ''}
                                </div>
                                <div class="volunteer-actions">
                                    ${volunteer.status === 'pending' ? `
                                        <button class="btn btn-success btn-small" onclick="respondToApplication(${volunteer.id}, 'approved')">
                                            <i class="fas fa-check"></i> Approve
                                        </button>
                                        <button class="btn btn-danger btn-small" onclick="respondToApplication(${volunteer.id}, 'rejected')">
                                            <i class="fas fa-times"></i> Reject
                                        </button>
                                    ` : volunteer.status === 'approved' ? `
                                        <button class="btn btn-info btn-small" onclick="contactVolunteer('${volunteer.volunteer_email}')">
                                            <i class="fas fa-envelope"></i> Contact
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `}
            </div>
        </div>
    `;
}

function contactVolunteer(email) {
    window.location.href = `mailto:${email}`;
}

async function respondToApplication(applicationId, response) {
    const message = prompt(`Please enter a message for the volunteer (optional):`);
    
    try {
        const apiResponse = await apiCall(`/api/emergency/applications/${applicationId}/respond`, {
            method: 'PUT',
            body: JSON.stringify({
                response: response,
                response_message: message || ''
            })
        });
        
        const result = await apiResponse.json();
        
        if (apiResponse.ok) {
            showNotification(`Application ${response} successfully!`, 'success');
            closeApplicationModal();
            loadApplications();
            loadOrganizationStats();
        } else {
            showNotification(result.error || `Failed to ${response} application`, 'error');
        }
    } catch (error) {
        handleApiError(error, `Failed to ${response} application`);
    }
}

// Close modals when clicking outside
window.addEventListener('click', function(e) {
    const createModal = document.getElementById('quickCreateModal');
    const applicationModal = document.getElementById('applicationModal');
    const volunteersModal = document.getElementById('volunteersModal');
    
    if (e.target === createModal) {
        closeQuickCreateModal();
    }
    if (e.target === applicationModal) {
        closeApplicationModal();
    }
    if (e.target === volunteersModal) {
        closeVolunteersModal();
    }
});
</script>

<style>
/* Modal Styles */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

/* Button Styles */
.btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
    justify-content: center;
    opacity: 1 !important;
    visibility: visible !important;
}

.btn-primary {
    background: #007bff;
    color: white;
    border: 1px solid #007bff;
}

.btn-primary:hover {
    background: #0056b3;
    border-color: #0056b3;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
    color: white;
    text-decoration: none;
}

.btn-secondary {
    background: #6c757d;
    color: white;
    border: 1px solid #6c757d;
}

.btn-secondary:hover {
    background: #545b62;
    border-color: #545b62;
    transform: translateY(-1px);
    color: white;
    text-decoration: none;
}

.btn-success {
    background: #28a745;
    color: white;
    border: 1px solid #28a745;
}

.btn-success:hover {
    background: #1e7e34;
    border-color: #1e7e34;
    transform: translateY(-1px);
    color: white;
    text-decoration: none;
}

.btn-danger {
    background: #dc3545;
    color: white;
    border: 1px solid #dc3545;
}

.btn-danger:hover {
    background: #bd2130;
    border-color: #bd2130;
    transform: translateY(-1px);
    color: white;
    text-decoration: none;
}

.btn-info {
    background: #17a2b8;
    color: white;
    border: 1px solid #17a2b8;
}

.btn-info:hover {
    background: #117a8b;
    border-color: #117a8b;
    transform: translateY(-1px);
    color: white;
    text-decoration: none;
}

.btn-small {
    padding: 6px 12px;
    font-size: 0.8rem;
}

/* Status and Priority Badge Styles */
.status-badge, .priority-badge, .approval-badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: bold;
    text-transform: uppercase;
    display: inline-block;
}

/* Status Badge Colors */
.status-badge.status-pending {
    background: #ffc107;
    color: #212529;
}

.status-badge.status-approved {
    background: #28a745;
    color: white;
}

.status-badge.status-active {
    background: #17a2b8;
    color: white;
}

.status-badge.status-completed {
    background: #6c757d;
    color: white;
}

.status-badge.status-rejected {
    background: #dc3545;
    color: white;
}

/* Priority Badge Colors */
.priority-badge.priority-low {
    background: #28a745;
    color: white;
}

.priority-badge.priority-medium {
    background: #ffc107;
    color: #212529;
}

.priority-badge.priority-high {
    background: #fd7e14;
    color: white;
}

.priority-badge.priority-critical {
    background: #dc3545;
    color: white;
}

/* Approval Badge */
.approval-badge.pending {
    background: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
}

.modal.show {
    opacity: 1;
    visibility: visible;
}

.modal-content {
    background: white;
    border-radius: 10px;
    max-width: 600px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    transform: scale(0.7);
    transition: transform 0.3s ease;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

.modal.show .modal-content {
    transform: scale(1);
}

.modal-large {
    max-width: 900px;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid #e9ecef;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 10px 10px 0 0;
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: white;
    opacity: 0.8;
    transition: opacity 0.3s;
}

.modal-close:hover {
    opacity: 1;
}

.modal-form {
    padding: 20px;
}

.modal-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #e9ecef;
}

.request-item {
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    transition: all 0.3s;
    background: white;
}

.request-item:hover {
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.request-item.status-pending {
    border-left: 4px solid #ffc107;
}

.request-item.status-approved {
    border-left: 4px solid #28a745;
}

.request-item.status-active {
    border-left: 4px solid #17a2b8;
}

.request-item.status-completed {
    border-left: 4px solid #6c757d;
    opacity: 0.8;
}

.request-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
}

.request-header h4 {
    margin: 0;
    color: #333;
    font-size: 1.1rem;
}

.request-badges {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.approval-badge {
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: bold;
    text-transform: uppercase;
}

.approval-badge.pending {
    background: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
}

.request-details p {
    margin: 0 0 10px 0;
    color: #666;
    line-height: 1.4;
}

.request-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    font-size: 0.85rem;
    color: #888;
}

.request-meta span {
    display: flex;
    align-items: center;
    gap: 5px;
}

.request-actions {
    display: flex;
    gap: 8px;
    margin-top: 15px;
    flex-wrap: wrap;
}

.request-actions .btn {
    opacity: 1 !important;
    visibility: visible !important;
    display: inline-flex !important;
}

.request-item {
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    transition: all 0.3s;
    background: white;
}

.request-item:hover {
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.application-item {
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    transition: all 0.3s;
    background: white;
}

.application-item:hover {
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

.application-item.status-pending {
    border-left: 4px solid #ffc107;
}

.application-item.status-approved {
    border-left: 4px solid #28a745;
}

.application-item.status-rejected {
    border-left: 4px solid #dc3545;
}

.application-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
}

.volunteer-info h4 {
    margin: 0 0 5px 0;
    color: #333;
    font-size: 1.1rem;
}

.request-title {
    margin: 0;
    color: #666;
    font-size: 0.9rem;
    font-style: italic;
}

.application-details {
    margin-bottom: 15px;
}

.application-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    font-size: 0.85rem;
    color: #888;
    margin-bottom: 10px;
}

.application-meta span {
    display: flex;
    align-items: center;
    gap: 5px;
}

.application-message {
    background: #f8f9fa;
    padding: 10px;
    border-radius: 5px;
    border-left: 3px solid #17a2b8;
    margin: 10px 0;
    font-style: italic;
    color: #555;
}

.application-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.application-details-content {
    padding: 20px;
}

.detail-section {
    margin-bottom: 25px;
}

.detail-section h3 {
    margin-bottom: 15px;
    color: #333;
    border-bottom: 2px solid #f8f9fa;
    padding-bottom: 8px;
    font-size: 1.1rem;
}

.detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.detail-item {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.detail-item label {
    font-weight: 600;
    color: #666;
    font-size: 0.9rem;
}

.detail-item span {
    color: #333;
}

.section-controls {
    display: flex;
    gap: 10px;
    align-items: center;
}

.section-controls select {
    padding: 8px 12px;
    border: 1px solid #e9ecef;
    border-radius: 5px;
    font-size: 0.9rem;
    background: white;
}

.loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 40px;
    color: #666;
}

.no-data {
    text-align: center;
    padding: 40px;
    color: #999;
    font-style: italic;
}

@media (max-width: 768px) {
    .request-header,
    .application-header {
        flex-direction: column;
        gap: 10px;
    }
    
    .request-badges,
    .application-badges {
        align-self: flex-start;
    }
    
    .request-meta,
    .application-meta {
        flex-direction: column;
        gap: 8px;
    }
    
    .modal-content {
        width: 95%;
        margin: 10px;
    }
    
    .detail-grid {
        grid-template-columns: 1fr;
    }
}

/* Volunteers Modal Styles */
.volunteers-content {
    padding: 20px;
}

.request-summary {
    margin-bottom: 25px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #17a2b8;
}

.request-summary h3 {
    margin-bottom: 15px;
    color: #333;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.summary-item {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.summary-item label {
    font-weight: 600;
    color: #666;
    font-size: 0.9rem;
}

.volunteers-section h3 {
    margin-bottom: 15px;
    color: #333;
    border-bottom: 2px solid #f8f9fa;
    padding-bottom: 8px;
}

.volunteers-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
}

.volunteer-card {
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    background: white;
    transition: all 0.3s;
}

.volunteer-card:hover {
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.volunteer-card.status-pending {
    border-left: 4px solid #ffc107;
}

.volunteer-card.status-approved {
    border-left: 4px solid #28a745;
}

.volunteer-card.status-rejected {
    border-left: 4px solid #dc3545;
}

.volunteer-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.volunteer-header h4 {
    margin: 0;
    color: #333;
    font-size: 1.1rem;
}

.volunteer-details {
    margin-bottom: 15px;
}

.volunteer-info {
    display: flex;
    flex-direction: column;
    gap: 5px;
    margin-bottom: 10px;
    font-size: 0.9rem;
    color: #666;
}

.volunteer-info span {
    display: flex;
    align-items: center;
    gap: 8px;
}

.volunteer-meta {
    display: flex;
    flex-direction: column;
    gap: 5px;
    font-size: 0.85rem;
    color: #888;
}

.volunteer-meta span {
    display: flex;
    align-items: center;
    gap: 5px;
}

.volunteer-message {
    background: #f8f9fa;
    padding: 8px;
    border-radius: 5px;
    border-left: 3px solid #17a2b8;
    margin: 10px 0;
    font-style: italic;
    color: #555;
    font-size: 0.9rem;
}

.volunteer-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}
</style>
{% endblock %}